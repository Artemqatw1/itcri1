function get_countrycode(){if(supportLocalStorage)return(new Date-new Date(null===localStorage.getItem("acharts_country_code_check")?0:localStorage.getItem("acharts_country_code_check"))>864e5||null===localStorage.getItem("acharts_country_code"))&&$.ajax({url:"//extreme-ip-lookup.com/json/",type:"GET",async:!0,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",success:function(e){return console.log(e),localStorage.setItem("acharts_country_code",e.countryCode),localStorage.setItem("acharts_country_code_check",new Date),e.country.code}}),localStorage.getItem("acharts_country_code")}function XHRfeedback(e,a,o,n){if(t=new Date,showtime=5e3,timedisplay=t.toTimeString(),timedisplay=timedisplay.split(" ")[0],n=void 0!==n,"success"==a){if(""!=e.feedback.text&&n===!1){var i='<div class="XHRline"><span class="XHRdate">'+timedisplay+"</span> "+(""!=e.feedback.url?'<a href="'+e.feedback.url+'">':"")+e.feedback.text+(""!=e.feedback.url?"</a>":"")+"</div>";XHRfeedback_clearqueue(),e.status.success===!0?$("#XHRconsole").queue(function(e){$(this).removeClass("red"),e()}).append(i).slideDown().delay(showtime).slideUp():$("#XHRconsole").queue(function(e){$(this).addClass("red"),e()}).append(i).slideDown().delay(showtime).slideUp()}void 0!==e.analytics&&"undefined"!=typeof ga&&ga("send","event",e.analytics.event_category,e.analytics.event_action,e.analytics.event_label)}else"error"==a?(XHRfeedback_clearqueue(),$("#XHRconsole").queue(function(e){$(this).addClass("red"),e()}).append('<div class="XHRline"><span class="XHRdate">'+timedisplay+"</span> A connection error occured. Please try again.</div>").slideDown().delay(showtime).slideUp()):"parsererror"==a&&(XHRfeedback_clearqueue(),$("#XHRconsole").queue(function(e){$(this).addClass("red"),e()}).append('<div class="XHRline"><span class="XHRdate">'+timedisplay+"</span> Syntax error: Unexpected token in JSON. Please try again.</div>").slideDown().delay(showtime).slideUp())}function XHRfeedback_clearqueue(){$("#XHRconsole .XHRline").hide(),0!=$("#XHRconsole").queue().length&&$("#XHRconsole").clearQueue().slideUp().queue(function(e){$(this).removeClass("red"),e()})}function adBlockDetected(){"undefined"!=typeof ga&&(ga("set","dimension4","blocked"),ga("set","dimension5",deviceGrade),send_event_adviewability("blocked"))}function adBlockNotDetected(){"undefined"!=typeof ga&&(ga("set","dimension4","viewable"),ga("set","dimension5",deviceGrade),send_event_adviewability("viewable"))}function send_event_adviewability(e){supportLocalStorage?new Date-new Date(null===localStorage.getItem("acharts_adviewability_check")?0:localStorage.getItem("acharts_adviewability_check"))>18e5||null===localStorage.getItem("acharts_adviewability")?(ga("send","event","adviewability",e,{nonInteraction:1}),localStorage.setItem("acharts_adviewability",e),localStorage.setItem("acharts_adviewability_check",new Date)):localStorage.setItem("acharts_adviewability_check",new Date):ga("send","event","adviewability",e,{nonInteraction:1})}function set_slick(){$("#ArtworkSlider").slick({infinite:!1,dots:!0,slidesToShow:1,slidesToScroll:1,slideRatio:1.5}),console.log("set slick option"),$("#ArtworkSlider").slick("slickSetOption",!0)}function load_element_artwork(){$.inArray("Artwork",visibleElements)!=-1&&(console.log("Artwork: resize"),set_slick())}function visible_element_artwork(){1==$("#ArtworkSlider:visible").length&&visibleElements.push("Artwork")}function set_charttooltip(e,t,a){var o=e.offset();a?$("#FlotActionTooltip").hide().removeClass("Red"):$("#FlotActionTooltip").hide().addClass("Red"),$("#FlotActionTooltip").html(t).fadeIn(100).css({left:o.left-20+"px",top:o.top+$(".st-content").scrollTop()-45+"px"}).delay(1500).fadeOut(100)}function add_chartlocal(){$("#PerformanceTable tr").each(function(e){$(this).data("chart-country")==get_countrycode()&&($(this).find(".cPrinciple a").css("font-weight",700),alreadyFetched[$(this).data("chart-id")]||update_chartdata($(this).find("svg.DrawGraph"),"automatic_local"))})}function update_chartdata(e,t,a){a&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0);var o=e.parent().parent().data("chart-id"),n={analytics:{send_event:!0,event_category:"performance-graph",event_action:t,event_label:""},status:{status_code:400,success:!1},feedback:{text:"",url:""}};alreadyFetched[o]?$.each(FlotData,function(t,a){if(a.chartid==o)return 1==$.map(alreadyFetched,function(e,t){return t}).length?(n.analytics.event_label="error_minimum_one_chart",n.feedback.text="The chart cannot be removed, the graph required at least one chart.",XHRfeedback(n,"success"),!1):(FlotData[t]=!1,delete alreadyFetched[o],e.children("path").attr("fill",FlotColors.default),n.status.status_code="410",n.status.success=!0,n.analytics.event_label="deleted",n.feedback.text="The chart is removed from the graph.",XHRfeedback(n,"success"),!1)}):$.map(alreadyFetched,function(e,t){return t}).length<4?(alreadyFetched[o]=!0,$.ajax({type:"POST",url:"/callback/GraphData",data:{titleid:TitleId,chart:o,initiator:t},dataType:"json",encode:!0}).done(function(t){if(t.status.success){var a=!1;$.each(FlotData,function(e,o){if(o===!1)return FlotData[e]=t.data,a=e,!1}),a===!1&&(FlotData.push(t.data),a=FlotData.length-1),e.children("path").attr("fill",FlotColors[TitleType][a]),delete a,$.plot($("#PerformanceChart"),FlotData,FlotSettings)}}).always(function(e,t,a){XHRfeedback(e,t,a)})):(n.analytics.event_label="error_too_many_lines",n.feedback.text="The graph supports up to four lines, remove a chart before adding a new one",XHRfeedback(n,"success")),$.plot($("#PerformanceChart"),FlotData,FlotSettings)}function load_element_chart(){$.inArray("PerformanceChart",visibleElements)!=-1&&(console.log("CHART: resize and draw"),$("#PerformanceChart").css({height:$("#PerformanceTable").width()/($("#PerformanceTable").width()>766?3.5:2.5)+"px"}),$.plot($("#PerformanceChart"),FlotData,FlotSettings),$.inArray("PerformanceChart",loadedElements)==-1&&(console.log("CHART: add first data"),update_chartdata($("svg.DrawGraph:first"),"automatic_first"),console.log("CHART: add local data"),setTimeout(add_chartlocal,2e3),loadedElements.push("PerformanceChart")))}function visible_element_chart(){1==$("#PerformanceChart:visible").length&&visibleElements.push("PerformanceChart")}function set_coversize(e){CoverMax?($("#DetailsCover").animate({width:"100%"},e?0:400),e||$("#ArtworkForm, #TracksForm, #DetailsTracks").slideUp()):($("#DetailsCover").animate({width:"D"==deviceGrade?"75%":"48.5%"},e?0:400),e||($("#DetailsTracks").slideDown(),$("#Tracklist").length||$("#TracksForm").slideToggle()))}function load_element_cover(){$.inArray("Cover",visibleElements)!=-1&&CoverOverwrite&&(console.log("Cover: resize"),set_coversize(!0))}function visible_element_cover(){1==$("#CoverImage:visible").length&&visibleElements.push("Cover")}function set_devicegrade(){console.log("fn set_devicegrade"),deviceGrade=["none","A","B","C","D"][$(".ResponsiveGrade").width()],console.log("Device Grade: "+deviceGrade)}function load_elements(){console.log("fn load_elements"),set_devicegrade(),load_element_chart(),load_element_map(),load_element_table(),load_element_video(),load_element_cover(),load_element_artwork(),console.log("loadedElements:"),console.log(loadedElements)}function set_elements(){console.log("fn set_elements"),set_visible_elements(),load_elements()}function set_visible_elements(){visibleElements=[],console.log("fn set_visible_elements"),visible_element_chart(),visible_element_map(),visible_element_table(),visible_element_video(),visible_element_cover(),visible_element_artwork(),console.log("visibleElements:"),console.log(visibleElements)}function load_element_map(){$.inArray("PerformanceMap",visibleElements)!=-1&&($.inArray("PerformanceMap",loadedElements)==-1&&(console.log("MAPS: load data"),$("#GeoPerfNA").vectorMap(MapSettings),$("#GeoPerfEU").vectorMap(MapSettings),$("#GeoPerfAU").vectorMap(MapSettings),loadedElements.push("PerformanceMap")),$("#GeoPerfNA").is(":visible")?(console.log("MAPS: set focus on regions"),$("#GeoPerfNA").vectorMap("set","focus",["CA","MX"]),$("#GeoPerfEU").vectorMap("set","focus",["ES","FI"]),$("#GeoPerfAU").vectorMap("set","focus",["ID","NZ"])):(console.log("MAPS: set focus on single map; on:"),console.log(MapFocus),$("#GeoPerfEU").delay(50).vectorMap("set","focus",MapFocus)))}function visible_element_map(){1==$("#GeoPerfEU:visible").length&&visibleElements.push("PerformanceMap")}function set_sheet(){var e=window.location.hash,t=!1,a=e.substring(1);$.inArray(a,sheets)==-1?a=sheets[0]:t=!0,$("#tabs ul li").removeClass("active"),$("#tabs ul li a").removeClass("active"),$('#tabs a[href="#'+a+'"]').parent().addClass("active"),$('#tabs a[href="#'+a+'"]').addClass("active"),$("main .sheet").hide(),$("main #"+a+"_sheet").fadeIn().resize(),"undefined"!=typeof ga&&1==t&&ga("send","event","navigation","tabs",a),set_elements()}function load_element_table(){$("table.sortable:visible").each(function(){$.inArray($(this).attr("id"),visibleElements)!=-1&&$.inArray($(this).attr("id"),loadedElements)==-1&&(console.log("TABLE: activate table sorter"),$("#"+$(this).attr("id")).tablesorter({textAttribute:"data-sort-value"}),loadedElements.push($(this).attr("id")))})}function visible_element_table(){$("table.sortable:visible").each(function(){visibleElements.push($(this).attr("id"))})}function load_element_video(){$.inArray("Video",visibleElements)!=-1&&(console.log("VIDEO: resize"),$(".YTvideo").css({height:$("div.Video").width()/1.77+"px"}))}function visible_element_video(){1==$(".Video iframe:visible").length&&visibleElements.push("Video")}var supportLocalStorage="undefined"!=typeof Storage;"undefined"==typeof blockAdBlock?adBlockDetected():(blockAdBlock.onDetected(adBlockDetected),blockAdBlock.onNotDetected(adBlockNotDetected)),$(function(){supportLocalStorage&&(null===localStorage.getItem("acharts_accept_consent")&&$.inArray(get_countrycode(),["BE","BG","CZ","DK","DE","EE","IE","GR","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","GB","UK"])&&$(".consentHolder").prepend('<!--googleoff: snippet--><div id="consentMessage">Acharts.co uses cookies to ensure you get the best experience. <a href="/privacy">More info</a><span class="GenBut">OK, got it</span></div><!--googleon: snippet-->'),$("#consentMessage .GenBut").click(function(){localStorage.setItem("acharts_accept_consent","true"),$("#consentMessage").fadeOut(250)}))}),$(window).on("load",function(){var e=(new Date).getTime(),t=e-startTime;$("#BrowserTime").append(t+" ms")}),$(window).on("load",function(){$(".ShowLogin").click(function(){window.open("/oAuth","AchartsOauth","location=yes, scrollbars=yes, resizable=yes, width=500, height=555")})}),$(function(){$("#search").submit(function(){var e=$("#search input").val().replace(/ /g,"_");$("#search").attr("action","/search/"+e.toLowerCase())})}),$(window).on("load",function(){$(".download").click(function(){"undefined"!=typeof ga&&ga("send","pageview",{page:$(this).data("path")})})}),$(window).on("load",function(){$(".ArtistSpace").click(function(){return $(this).find("a").attr("href")&&(window.location=$(this).find("a").attr("href")),!1})}),$(window).on("load",function(){$("#tabs ul li:not(.notab)").click(function(){window.location.hash=$(this).children("a").attr("href"),event.preventDefault?event.preventDefault():event.returnValue=!1})}),$(window).on("load",function(){$(".slick-slide").click(function(){$(this).animate({height:$(this).width()/$(this).data("ratio")+"px"},400)})}),$(window).on("load",function(){$("#PerformanceChart").bind("plothover",function(e,t,a){if(a){var o=new Date(a.datapoint[0]);$("#FlotTooltip").html('<span class="Nr">#'+a.series.data[a.dataIndex][2]+"</span> "+a.series.label+" ("+o.strftime("%V/%y")+")").css({top:a.pageY+22,left:a.pageX-30}).fadeIn(200)}else $("#FlotTooltip").hide()})}),$(window).on("load",function(){$("svg.DrawGraph").click(function(e){update_chartdata($(this),"user_initiated",e)})});var FlotData=[],alreadyFetched={},FlotColors={album:["#fed105","#363b34","#ffe694","#8d928a"],song:["#00a5e3","#363b34","#8cd6f2","#8d928a"],default:"#c8c8c8"},FlotSettings={legend:{show:!1},series:{lines:{show:!0,lineWidth:4},points:{show:!0,fill:!1},shadowSize:0},xaxis:{show:!0,mode:"time",minTickSize:[7,"day"],tickFormatter:function(e,t){return new Date(e).strftime("%V/%y")},color:"#ffffff",font:{family:"roboto",weight:100,style:"italic",color:"#8C8E8C"},tickDecimals:0,tickLength:0},yaxis:{font:{size:0},max:100,min:0},colors:FlotColors[TitleType],grid:{hoverable:!0,clickable:!0,autoHighlight:!0,borderWidth:{top:0,left:0,right:0,bottom:2},borderColor:{bottom:"#8C8E8C"},margin:{top:10,bottom:10}}};$(window).on("load",function(){if($("#InitiateUpload").length){if(TitleId>1)var e="cover",t="album",a=TitleId;else if(""!=ArtistName)var e=t="artist",a=ArtistName;var o={analytics:{send_event:!0,event_category:"contributions",event_action:t+"artwork",event_label:""},status:{status_code:400,success:!1},feedback:{text:"",url:""}};new ss.SimpleUpload({dropzone:"ArtworkForm",dragClass:"DragZoneHover",button:"InitiateUpload",url:"/callback/SubmitArtwork?type="+e+"&objectid="+a,name:"filename",responseType:"json",allowedExtensions:["jpg","jpeg","png"],accept:"image/*",maxSize:5012,onExtError:function(e,t){o.analytics.event_label="error_extension",o.feedback.text="<i>"+e+"</i> is not a permitted file type. Only JPG and PNG files are allowed.",XHRfeedback(o,"success")},onSizeError:function(e,t){o.analytics.event_label="error_file_size",o.feedback.text="<i>"+e+"</i> is too big. The maximum file size is 5MB.",XHRfeedback(o,"success")},onSubmit:function(e,t){$("#StandardUploadMsg").hide(),$("#UploadMsg").show().html("<strong>UPLOADING</strong><br>File: <i>"+e+"</i><br>File size: <span id='FileSize'>Unknown</span>"),$("#UploadProgress").css({height:"2px"}),this.setFileSizeBox($("#FileSize")),this.setProgressBar($("#UploadProgress"))},startXHR:function(){$("#UploadMsg").append("<span id='CancelUpload' style='display: table' class='GenBut "+("cover"==e?"Yellow":"Green")+"'>Cancel upload</span>"),this.setAbortBtn($("#CancelUpload"),!0)},onAbort:function(){o.analytics.event_label="error_transfer_aborted",o.feedback.text="The upload process has been cancelled by the user.",XHRfeedback(o,"success"),$("#StandardUploadMsg").show(),$("#UploadMsg").hide(),$("#UploadProgress").css("width",0)},onError:function(e,t,a,n,i,s,l){XHRfeedback(o,"parsererror"),$("#StandardUploadMsg").show(),$("#UploadMsg").hide(),$("#UploadProgress").css("width",0)},onComplete:function(t,a){if(201==a.status.status_code||202==a.status.status_code){var o=DrawPath+"/"+(a.data.isLive?e:"upload")+"/"+encodeURIComponent(a.data.file)+"?"+Math.floor(1e5*Math.random());"cover"==e?($("#ArtworkForm").remove(),0==$("#CoverImage").length&&visibleElements.push("Cover"),1==$("#CoverImage:visible").length?$("#CoverImage").attr("src",o):$(".CoverWrapper").show().html('<img src="'+o+'" id="CoverImage">')):"artist"==e&&($("#ArtworkSlider").slick("slickAdd",'<div class="aa" style="background-image: url(\''+o+"');\"></div>"),$("#ArtworkSlider").slick("slickGoTo",$(".slick-track").find(".slick-slide").length),$("#StandardUploadMsg").show(),$("#UploadMsg").hide(),$("#UploadProgress").css("width",0))}else $("#StandardUploadMsg").show(),$("#UploadMsg").hide(),$("#UploadProgress").css("width",0);XHRfeedback(a,"success")}})}}),$(function(){$("#MBForm").submit(function(e){var t=$("#MBForm").serialize();$.ajax({type:"POST",url:$(this).attr("action"),data:t,dataType:"json",encode:!0}).done(function(e){e.status.success&&$("#MBForm").hide()}).always(function(e,t,a){XHRfeedback(e,t,a)}),e.preventDefault()})}),$(function(){$("#MVForm").submit(function(e){var t=$("#MVForm").serialize();$.ajax({type:"POST",url:"/callback/SubmitVideo",data:t,dataType:"json",encode:!0}).done(function(e){e.status.success&&($("#MVForm").hide(),e.data.YoutubeID&&($(".Video").html('<iframe src="https://www.youtube-nocookie.com/embed/'+e.data.YoutubeID+'?rel=0&amp;iv_load_policy=3&amp;controls=2&amp;showinfo=0&amp;modestbranding=true" class="YTvideo" width="100%" height="500" allowfullscreen="true"></iframe>'),visibleElements.push("Video"),set_elements()))}).always(function(e,t,a){XHRfeedback(e,t,a)}),e.preventDefault()})}),$(window).on("load",function(){$("#ContributeDetails").click(function(){CoverMax||($(".CoverWrapper img").length&&$("#ArtworkForm").slideToggle(),$("#Tracklist").length&&$("#TracksForm").slideToggle())})}),$(window).on("load",function(){$("#ContributeArtist").click(function(){$("#ArtworkSlider").find("div").length&&$("#ArtworkForm").slideToggle(),$("#Biography").length&&$("#MBFullForm").slideToggle()})}),$(window).on("load",function(){$("#ShowMBForm").click(function(){$(".Result .MBInitial, .Result .MBFormInfo, .Result #MBForm").toggle()})}),$(window).on("load",function(){$("#ContributeVideo").click(function(){$("#MVFormSet").slideToggle()})});var CoverMax=!1,CoverOverwrite=!1;$(window).on("load",function(){$("#CoverImage").click(function(){CoverMax=!CoverMax,CoverOverwrite=!0,set_coversize(!1)})});var deviceGrade="none",loadedElements=[],visibleElements=[],LastWindowCall=0,WindowWidth=$(window).width();$(function(){$(window).on("resize",function(){if(WindowWidth!=$(window).width()){var e=Date.now();LastWindowCall+1e3<e&&(LastWindowCall=e,WindowWidth=$(window).width(),console.log("window resized: fn set_elements"),set_elements())}})}),$(function(){1==$("#PerformanceTable").length&&$("#PerformanceTable tbody tr").each(function(){"FR"==$(this).data("chart-country")?MapFocus.push("BE","ES"):"US"==$(this).data("chart-country")?MapFocus.push("CA","MX"):MapFocus.push($(this).data("chart-country"))})});var MapFocus=[],MapSettings={map:"world_mill_en",zoomButtons:!1,panOnDrag:!1,regionStyle:{initial:{fill:"#e7e9e7"}},backgroundColor:"#ffffff",series:{regions:[{values:MapData.colors}]},onRegionLabelShow:function(e,t,a){if(!MapData.labels[a])return e.preventDefault(),!1;var o="",n=0,i=0;$.each(MapData.labels[a],function(e,t){n++}),$.each(MapData.labels[a],function(e,t){o+='<span class="Nr">'+("Not Charted"===MapData.labels[a][e].peak?"":"#")+MapData.labels[a][e].peak+"</span> "+MapData.labels[a][e].chart+(i++<n?"<br>":"")}),t.css("top",$(this).offset().top+$(".st-content").scrollTop()),t.html(o)}};$(function(){$("#menu-accordion h3").click(function(){var e=$(this).parent().hasClass("active");$("#menu-accordion li").removeClass("active"),e||$(this).parent().addClass("active"),$("#menu-accordion li:not(.active) ul").slideUp(),$("#menu-accordion li.active ul").slideDown(),setTimeout(function(){$(".nano").nanoScroller()},500)})}),$(function(){$(".st-pusher").click(function(){$("#st-container").hasClass("st-menu-open")&&($("#st-container").removeClass("st-menu-open"),"undefined"!=typeof ga&&ga("send","event","navigation","slidemenu","close-content"))}),$(".st-trigger").click(function(e){e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0),$("#st-container").addClass("st-menu-open"),"undefined"!=typeof ga&&ga("send","event","navigation","slidemenu","open-"+$(this).data("trigger"))})}),$(function(){$(".nano").nanoScroller()});var sheets=[],activeSheet="";$(function(){$("main .sheet").each(function(){sheets.push($(this).attr("id").replace("_sheet",""))}),set_sheet()}),$(window).on("load",function(){$(window).bind("hashchange",function(){set_sheet()})}),$(window).on("load",function(){$("td, th.Ico").click(function(){return $(this).find("a").attr("href")&&(window.location=$(this).find("a").attr("href")),!1})});